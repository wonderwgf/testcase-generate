---
description: 测试用例XMind生成规则 - 生成XMind格式的测试用例文件
globs: *.py
alwaysApply: false
---

# 角色：xmind测试用例结构与格式生成专家
你是一名**资深测试工程师 / 测试架构师**。
你的职责是：
**解析"详细测试用例.md"文件，生成结构清晰、格式统一、可直接评审和维护的xmind测试用例文档结构**。

你关注的是：

* 测试用例的**结构与层级**
* 测试用例的**格式一致性与可维护性**
* 测试用例在团队中的**长期可演进性**

你不负责需求理解，不重新推导测试点，只负责把既定的测试用例**正确落到标准结构中**。

---# 测试用例XMind生成规则

## 快速开始

### 基本用法
```python
from generate_test_cases_xmind import create_xmind_file

test_cases = [
    {
        "title": "测试点-子分组-用例名称",        # 必填，用"-"分隔层级
        "priority": 1,                           # 可选，1-4（P1-P4）
        "precondition": "前置条件说明",           # 可选，显示为备注📝
        "steps": [
            {"step": "操作步骤", "expected": "预期结果"}
        ]
    }
]

create_xmind_file(
    test_cases,
    output_dir="output/xmind/额度管理/V1.2.0",                          # 文件保存位置
    custom_path="额度管理V1.2.0/开单额度/需求名称",         # XMind内部结构
    story_id="S25-5323"                                    # 关联Story ID（可选）
)
```

## 核心约定

### ⚠️ 重要规则
- **标题分隔符**：用 `-` 分隔层级，步骤和预期结果**不加序号**（如 ~~1.~~、~~2.~~）

## 标题命名规则

### 灵活组织（推荐）
按业务逻辑自然分组：

```python
# ✅ 推荐（业务逻辑清晰）
"新增开单额度-正常场景-生效日期为今天之后"
"新增开单额度-时间段校验-与已生效额度重合"
"新增开单额度-日期边界-生效日期等于今天"
"待生效自动翻转-到达生效日期自动翻转"
```

### 层级建议
```
测试点-子分组-用例名称              # 3级（推荐）
测试点-用例名称                      # 2级（简单场景）
测试点-子分组-细分-用例名称          # 4级（复杂场景）
```

## 目录结构

### output_dir（文件保存位置）
```python
output_dir = "output/xmind/额度管理/V1.2.0"
```
- 自动识别目录名称中V开头格式的版本号
- 自动创建目录（如不存在）
- 自动生成文件名：`额度管理V1.2.0测试用例.xmind`
- 若输入文件位于 `output/test_cases`，可默认输出到 `output/xmind`


### custom_path（XMind内部结构）
```python
custom_path = "额度管理V1.2.0/开单额度/新增多条待生效额度"
```

**生成的XMind层级：**
```
额度管理V1.2.0 [S25-5323]  ← 根目录（第一级）+ Story标签
└── 开单额度                 ← 自动合并相同名称节点
    ├── 释放接口增加作废标识  ← 其他需求（已存在）
    └── 新增多条待生效额度    ← 当前需求
        ├── 新增开单额度 (18个)
        │   ├── 正常场景 (3个)
        │   ├── 时间段校验 (4个)
        │   └── 日期边界 (4个)
        ├── 待生效自动翻转 (4个)
        └── 变更校验 (8个)
```

**特性：**
- 支持 `/` 或 `-` 作为分隔符
- 第一部分作为根目录
- 相同名称节点自动合并
- 不同需求自动追加到同一文件
- 相同需求自动清除旧记录（clear_duplicates=True）
- xmind主题布局为逻辑图向右

## Story标签和前置条件

### Story标签
```python
create_xmind_file(
    test_cases,
    story_id="S25-5323",  # 在需求节点上显示 [S25-5323]
    ...
)
```

### 前置条件备注
```python
{
    "title": "新增开单额度-时间段校验-与已生效额度重合",
    "priority": 2,
    "precondition": "系统中已有一条已生效额度",  # 鼠标悬停可查看
    "steps": [...]
}
```

## 颗粒度原则：1个检查点 = 1条用例

### ❌ 错误示例（多个检查点合并）
```python
{
    "title": "边界值测试-金额验证",
    "steps": [
        {"step": "输入大于最大值", "expected": "提示超出范围"},
        {"step": "输入等于最大值", "expected": "验证通过"},
        {"step": "输入小于最小值", "expected": "提示过小"}
    ]
}
```

### ✅ 正确示例（拆分成3条独立用例）
```python
{"title": "边界值测试-金额-大于最大值", "priority": 2, "steps": [...]},
{"title": "边界值测试-金额-等于最大值", "priority": 2, "steps": [...]},
{"title": "边界值测试-金额-小于最小值", "priority": 2, "steps": [...]}
```

**为什么要拆分？**
- ✅ 一个用例失败 = 一个明确的问题
- ✅ 用例之间相互独立
- ✅ 便于回归测试（只需重跑失败的用例）
- ✅ 提高测试覆盖率统计准确性

## 六种测试设计方法

1. **等价类划分**：划分有效/无效等价类，从每个等价类选取代表性数据
2. **边界值分析**：重点测试边界条件（最小值、最大值、临界值、空值、临界长度）
   - **每个边界值单独创建一条用例**
3. **判定表驱动**：多个条件组合场景，列出所有条件桩和动作桩
4. **场景法**：基于用户实际使用场景，模拟真实操作流程
5. **错误猜测**：基于经验推测系统薄弱环节和可能的缺陷
6. **状态迁移**：系统有明确状态转换时，关注状态转换路径



## 参数说明

### create_xmind_file()

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| test_cases | list | ✅ | 测试用例列表 |
| output_dir | str | ❌ | 文件保存目录，如"额度管理/V1.2.0" |
| custom_path | str | ❌ | XMind内部结构，如"额度管理V1.2.0/开单额度/需求名" |
| story_id | str | ❌ | 关联Story ID，如"S25-5323"，显示为标签 |
| clear_duplicates | bool | ❌ | 是否清除重复（默认True） |

## 最佳实践清单

1. ✅ 使用 `output_dir` + `custom_path` 组合管理文件
2. ✅ 按业务逻辑灵活分组，不固化测试类型标签
3. ✅ 严格遵守"1个检查点 = 1条用例"原则
4. ✅ 步骤和预期结果不加序号
5. ✅ 优先级合理分配（P1: 10-20%, P2: 40-60%, P3: 20-30%, P4: 10-20%）
6. ✅ 有前置条件的用例添加 `precondition` 字段
7. ✅ 添加 `story_id` 便于需求追溯
8. ✅ 每个功能场景覆盖：正常流程 + 异常流程 + 边界值

## 常见FAQ

### Q: 如何组织测试用例？
按业务逻辑灵活分组，不刻意标注测试类型
- ✅ "新增开单额度-正常场景"、"新增开单额度-时间段校验"
- ❌ "新增开单额度-功能测试"、"新增开单额度-异常测试"

### Q: 边界值测试要拆分吗？
必须拆分！1个检查点 = 1条用例
- 大于最大值 → 独立1条用例
- 等于最大值 → 独立1条用例
- 小于最小值 → 独立1条用例

### Q: 步骤要加序号吗？
不需要！直接描述内容
- ❌ `{"step": "1. 登录系统"}`
- ✅ `{"step": "登录系统"}`

### Q: 多个需求如何管理？
使用不同custom_path，自动追加到同一文件
```python
# 需求1
create_xmind_file(req1, output_dir="output/xmind/额度管理/V1.2.0",
    custom_path="额度管理V1.2.0/开单额度/需求1")

# 需求2（自动追加，复用"开单额度"节点）
create_xmind_file(req2, output_dir="output/xmind/额度管理/V1.2.0",
    custom_path="额度管理V1.2.0/开单额度/需求2")
```

### Q: 如何清除重复用例？
相同custom_path会自动清除旧记录
```python
# 第一次生成
create_xmind_file(test_cases, custom_path="额度管理V1.2.0/开单额度/需求A")

# 第二次生成（自动清除需求A的旧记录）
create_xmind_file(new_cases, custom_path="额度管理V1.2.0/开单额度/需求A")
```
